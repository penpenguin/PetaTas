---
// Panel.astro - Main Chrome Extension Side Panel
import "/src/styles/main.css"

export interface Props {
  title?: string;
}

const { title = 'PetaTas' } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PetaTas - Task Manager</title>
  </head>
  <body>
    <div id="panel-root">
      <div class="drawer drawer-mobile">
        <div class="drawer-content">
          <!-- Navbar with controls -->
          <div class="navbar bg-base-100 shadow-lg">
            <div class="flex-1">
              <h1 class="text-xl font-bold" data-testid="panel-title">{title}</h1>
            </div>
            <div class="flex-none gap-2">
              <button 
                class="btn btn-primary btn-sm" 
                data-testid="paste-button"
                id="paste-button"
              >
                Paste Markdown
              </button>
              <button 
                class="btn btn-secondary btn-sm" 
                data-testid="add-task-button"
                id="add-task-button"
              >
                Add Task
              </button>
              <button 
                class="btn btn-error btn-outline btn-sm" 
                data-testid="clear-all-button"
                id="clear-all-button"
                title="Clear all tasks"
              >
                Clear All
              </button>
              <button 
                class="btn btn-outline btn-sm" 
                data-testid="export-button"
                id="export-button"
              >
                Export
              </button>
            </div>
          </div>

          <!-- Main content area -->
          <div class="container mx-auto px-4 py-2 flex-1 flex flex-col min-h-0 overflow-hidden">
            <div class="task-list-container flex-1 min-h-0">
              <!-- Empty state -->
              <div class="empty-state text-center py-8" data-testid="empty-state" id="empty-state">
                <div class="text-gray-500">
                  <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <p class="text-lg font-medium">No tasks yet. Paste a Markdown table to get started!</p>
                  <p class="text-sm mt-2">Copy a table from anywhere and click "Paste Markdown" to create your task list.</p>
                </div>
              </div>

              <!-- Task list -->
              <div class="list hidden" data-testid="task-list" id="task-list">
                <!-- Task rows will be dynamically inserted here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Task Modal -->
    <input type="checkbox" id="add-task-modal" class="modal-toggle" />
    <div class="modal">
      <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">Add New Task</h3>
        <form id="add-task-form" class="space-y-4">
          <!-- All fields will be dynamically inserted here -->
          <div id="dynamic-fields-container"></div>
          
          <div class="modal-action">
            <label for="add-task-modal" class="btn btn-ghost">Cancel</label>
            <button type="submit" class="btn btn-primary">Add Task</button>
          </div>
        </form>
      </div>
      <label class="modal-backdrop" for="add-task-modal"></label>
    </div>


    <!-- Toast notifications -->
    <div class="toast toast-end" id="toast-container">
      <!-- Toast messages will be dynamically inserted here -->
    </div>

    <!-- Client-side JavaScript -->
    <script is:inline src="/panel-client.js" type="text/javascript"></script>
  </body>
</html>
