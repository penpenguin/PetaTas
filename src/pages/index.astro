---
// Panel.astro - Main Chrome Extension Side Panel
import "/src/styles/main.css"
// Inline SVG icons are used to avoid framework renderer requirements

export interface Props {
  title?: string;
}

const { title = 'PetaTas' } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" data-theme="fantasy">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PetaTas - Task Manager</title>
  </head>
  <body>
    <div id="panel-root" class="min-w-[360px] w-full">
      <div class="drawer drawer-mobile">
        <div class="drawer-content">
          <!-- Navbar with controls -->
          <div class="navbar bg-base-200 shadow-lg min-h-12">
            <div class="flex-1">
              <h1 class="text-xl font-bold ml-2" data-testid="panel-title">{title}</h1>
            </div>
            <div class="flex-none gap-2">
              <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-sm" aria-label="Actions">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5">
                    <circle cx="12" cy="5" r="1.5"/>
                    <circle cx="12" cy="12" r="1.5"/>
                    <circle cx="12" cy="19" r="1.5"/>
                  </svg>
                </label>
                <ul tabindex="0" class="menu menu-sm dropdown-content z-50 mt-2 p-2 shadow bg-base-200 rounded-box w-56">
                  <li>
                    <button id="paste-button" data-testid="paste-button">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4">
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zm-7-1a1 1 0 011 1h-2a1 1 0 011-1zM19 19H5V5h2v2h10V5h2v14z"/>
                      </svg>
                      <span>Paste Markdown</span>
                    </button>
                  </li>
                  <li>
                    <button id="add-task-button" data-testid="add-task-button">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4">
                        <path d="M12 5v14m-7-7h14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                      </svg>
                      <span>Add Task</span>
                    </button>
                  </li>
                  <li>
                    <button id="export-button" data-testid="export-button">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4">
                        <path d="M5 20h14v-2H5v2zm7-16l5 5h-3v4h-4v-4H7l5-5z"/>
                      </svg>
                      <span>Export</span>
                    </button>
                  </li>
                  <li>
                    <button id="clear-all-button" data-testid="clear-all-button" class="tooltip" data-tip="Clear all tasks">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4">
                        <path d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 7h2v8h-2v-8zm4 0h2v8h-2v-8z"/>
                      </svg>
                      <span>Clear All</span>
                    </button>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Main content area -->
          <div class="mx-auto py-0 flex-1 flex flex-col min-h-0 overflow-hidden max-w-none w-full">
            <div class="flex-1 min-h-0 overflow-y-auto overflow-x-hidden basis-0 pl-2.5 pr-2.5">
              <!-- Empty state -->
              <div class="empty-state text-center py-8 flex flex-col items-center justify-center h-full" data-testid="empty-state" id="empty-state">
              <div class="text-base-content/70">
                  <svg class="w-16 h-16 mx-auto mb-4 text-base-content/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <p class="text-lg font-medium">No tasks yet. Paste a Markdown table to get started!</p>
                  <p class="text-sm mt-2">Copy a table from anywhere and click "Paste Markdown" to create your task list.</p>
                </div>
              </div>

              <!-- Task list -->
              <div class="list hidden space-y-2 my-2" data-testid="task-list" id="task-list">
                <!-- Task rows will be dynamically inserted here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Task Modal -->
    <input type="checkbox" id="add-task-modal" class="modal-toggle" />
    <div class="modal">
      <div class="modal-box bg-base-200">
        <h3 class="font-bold text-lg mb-4">Add New Task</h3>
        <form id="add-task-form" class="space-y-4">
          <!-- All fields will be dynamically inserted here -->
          <div id="dynamic-fields-container"></div>
          
          <div class="modal-action">
            <label for="add-task-modal" class="btn btn-ghost">Cancel</label>
            <button type="submit" class="btn btn-primary">Add Task</button>
          </div>
        </form>
      </div>
      <label class="modal-backdrop" for="add-task-modal"></label>
    </div>


    <!-- Toast notifications -->
    <div class="toast toast-end" id="toast-container">
      <!-- Toast messages will be dynamically inserted here -->
    </div>

    <!-- Client-side JavaScript -->
    {import.meta.env.DEV
      ? (<script type="module" src="/src/panel-client.ts"></script>)
      : (<div set:html={'<script src="/panel-client.js"></script>'}></div>)}
  </body>
</html>
