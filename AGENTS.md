# Repository Guidelines

## Project Structure & Module Organization
```
src/
  components/       # UI components (.astro, PascalCase)
  pages/            # Astro pages (panel shell)
  utils/            # Helpers (kebab-case .ts)
  types/            # Shared types (PascalCase types/interfaces)
  styles/           # Tailwind styles
public/             # Static assets
tests/              # unit/integration: components|features|utils|pages|performance
dist/               # Build output (load via chrome://extensions)
```
Key files: `src/panel-client.ts` (side panel logic), `src/service-worker.ts` (background), `tailwind.config.mjs`, `vitest.config.ts`.

## Build, Test, and Development Commands
- `npm install`: install dependencies.
- `npm run dev`: start Astro dev server.
- `npm run build`: produce extension bundle in `dist/`.
- `npm run preview`: serve the production build locally.
- `npm test`: run Vitest unit tests (jsdom environment).
- `npm test -- --coverage`: generate V8 coverage (text/json/html in `coverage/`).
- `npm run lint` / `npm run typecheck`: ESLint and Astro/TS checks.

## Coding Style & Naming Conventions
- Indentation: 2 spaces; TypeScript strict mode.
- Filenames: `.astro` components in PascalCase (e.g., `TaskRow.astro`); TS modules kebab-case (e.g., `panel-client.ts`, `service-worker.ts`).
- Code: variables/functions `camelCase`, types/interfaces `PascalCase`.
- Imports: use alias `@` for `src` (e.g., `import { x } from '@/utils/x'`).
- Linting: ESLint with `@typescript-eslint`, `eslint-plugin-astro`. Rules include no unused vars (prefix with `_` to ignore), prefer `const`, avoid `any` (warn).

## Testing Guidelines
- Framework: Vitest + jsdom; setup in `tests/setup.ts` (Chrome/clipboard mocks).
- Test files: `tests/**/*.{test,spec}.{ts,js}`; keep colocated by domain (components/features/utils/pages).
- Run focused tests: `npx vitest -t "name"`.
- Coverage: `npm test -- --coverage`; keep meaningful coverage for changed code.

## Commit & Pull Request Guidelines
- Commits: imperative, concise subjects (e.g., "Fix export parsing bug", "Improve task UI layout").
- Reference scope when helpful (e.g., `utils:` / `components:`). Link issues in body.
- PRs must: describe change and rationale, link issues, include before/after screenshots for UI, outline test steps, and pass `npm test`, `npm run lint`, `npm run typecheck`, and `npm run build`.
- Keep PRs focused and under ~300 lines when possible.

## Security & Configuration Tips
- Do not store secrets; use `chrome.storage` only for non-sensitive task data.
- Sanitize user-pasted Markdown; avoid unsafe DOM operations.
- Review permissions before editing the Manifest V3 config; favor least privilege.

## Development Approach (t-wada TDD - MUST)
- Strict policy: all code changes follow Takuto Wada’s TDD.
- Red → Green → Refactor in the smallest possible steps.
- Start from the simplest failing test; use triangulation to evolve behavior.
- Write a failing test for any bug before fixing it.
- Prefer fast unit tests with Vitest + jsdom; add E2E only for critical flows.
- Keep production code minimal to satisfy current tests; refactor safely after green.
- Commit in small increments that reflect TDD phases where practical.

## Claude Guidance Carryover
- Project overview: PetaTas is a Chrome Extension (MV3) that converts Markdown tables into interactive task lists shown in Chrome’s side panel (Chrome 114+).
- Core technologies: Astro + Tailwind/daisyUI, MV3 service worker, `chrome.storage.sync`, Side Panel API, Clipboard API, Vitest + jsdom.
- Extension structure: `manifest.json` (permissions), `src/service-worker.ts` (lifecycle), panel HTML generated by Astro, UI under `src/components/`.
- State management: persist via `chrome.storage.sync` (100KB total, ~8KB/item); timer state stores timestamps to survive worker restarts; persist on every change.
- Key features: clipboard Markdown parsing to tasks; per-task timers with start/stop; secure clipboard operations using `navigator.clipboard`.
- Important constraints: Chrome 114+ only; target <150ms paste-to-render for ~100 rows; Secure Context required for clipboard; service worker may idle—persist promptly.
