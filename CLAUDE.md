# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

PetaTas is a Chrome Extension (Manifest V3) that converts Markdown tables into interactive task lists displayed in a Chrome side panel. It uses the Side Panel API (Chrome 114+) to provide always-accessible task management.

## Core Technologies

- **UI Framework**: Astro 2.x + daisyUI (Tailwind CSS based)
- **Extension**: Manifest V3 with service-worker
- **Storage**: chrome.storage.sync for cloud sync
- **APIs**: Side Panel API, Clipboard API (navigator.clipboard)
- **Testing**: Vitest + jsdom (unit), Playwright (E2E)

## Key Commands

```bash
# Install dependencies
npm install

# Development build
npm run dev

# Production build
npm run build -- --site chrome-extension://<extension-id>/

# Run tests
npm test

# Run specific test
npm test -- path/to/test.test.ts

# E2E tests
npm run test:e2e

# Lint
npm run lint

# Type check
npm run typecheck
```

## Architecture

### Extension Structure
- **manifest.json**: Declares permissions (sidePanel, storage, clipboardRead/Write)
- **service-worker**: Background script handling extension lifecycle
- **panel.html**: Side panel entry point (generated by Astro)
- **src/components/**: Astro components using daisyUI classes
  - Task list using `list`/`list-row` components
  - Timer functionality with start/stop controls
  - Markdown import/export UI

### State Management
- Uses chrome.storage.sync with 100KB limit (8KB per item)
- Timer state includes start timestamps to handle service-worker restarts
- All task data persisted on every change

### Key Functionalities
1. **Markdown Parsing**: Converts clipboard Markdown tables to task objects
   - Header row becomes object keys (normalized to snake_case)
   - Remaining rows become task array
2. **Timer System**: Per-task timers with persistence across panel reopens
3. **Clipboard Operations**: Uses Secure Context-only navigator.clipboard API

## Development Approach

This project follows TDD (Test-Driven Development) with the t_wada methodology:
1. Red → Green → Refactor cycles
2. Start with simplest test cases
3. Use triangulation to expand test coverage
4. E2E tests in Given-When-Then format

## Important Constraints

- Chrome 114+ only (Side Panel API requirement)
- Performance target: <150ms for paste-to-render (100 rows)
- Secure Context required for clipboard operations
- Service-worker may idle - always persist timer state immediately